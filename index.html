<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>jQuery TODO App with Email & Toast</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <style>
   /* BASE STYLES */
body {
    font-family: "Inter", Arial, sans-serif;
    padding: 20px;
    max-width: 450px;
    margin: auto;
    background: radial-gradient(circle, #1F2937, #4f6485,#99a8c5);
    color: #1F2937;
    animation: fadeIn 0.6s ease;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

h2 { text-align:center; font-size:26px; font-weight:700; color:#ffffff; margin-bottom:20px; }

#taskInput { 
    width: 80%; 
    padding: 10px; 
    border-radius: 8px; 
    border: 1px solid #d1d5db; 
    transition: 0.3s ease; 
}
#btnAdd { 
    padding: 10px 14px; 
    background: #4F46E5; 
    color: white; 
    border: none; 
    border-radius: 8px; 
    cursor: pointer; 
    transition: 0.3s ease;
}
#btnAdd:hover { transform: scale(1.06); background: #4338CA; }

ul { margin-top: 20px; padding: 0; }
li { 
    list-style: none; 
    background: white; 
    padding: 12px 14px; 
    margin: 6px 0; 
    border-radius: 10px; 
    display: flex; 
    justify-content: space-between; 
    align-items: center; 
    cursor: pointer; 
    transition: 0.25s ease; 
}
li:hover { transform: translateY(-3px); box-shadow: 0 6px 18px rgba(0,0,0,0.1); }
.done { text-decoration: line-through; background:#d1fae5 !important; border-left:6px solid #22C55E; }

button.removeBtn { background:#EF4444; color:white; border:none; padding:6px 10px; border-radius:6px; cursor:pointer; transition:0.3s ease; }
button.removeBtn:hover { background:#DC2626; transform: scale(1.1); }

#clearAll { margin-top:15px; padding:10px 12px; background:#111827; color:white; border:none; border-radius:10px; width:100%; cursor:pointer; transition:0.3s ease; }
#clearAll:hover { background:#000; transform: scale(1.03); }

/* MODAL */
#editModal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); justify-content:center; align-items:center; padding:10px; }
.modalBox { background:white; padding:20px; width:100%; max-width:350px; border-radius:12px; box-shadow:0 6px 20px rgba(0,0,0,0.2); }
#editInput { width:100%; padding:10px; margin-bottom:20px; border-radius:8px; border:1px solid #ccc; font-size:16px; }
.modalBtns { display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap; }
.modalBtns button { flex:1; padding:12px 0; font-size:16px; border:none; border-radius:8px; cursor:pointer; font-weight:bold; transition:0.3s ease; }
#saveEdit { background:#4F46E5; color:white; }
#saveEdit:hover { background:#4338CA; transform: scale(1.05); }
#cancelEdit { background:#EF4444; color:white; }
#cancelEdit:hover { background:#DC2626; transform: scale(1.05); }

/* Toast styling */
#toast { position:fixed; bottom:30px; left:50%; transform:translateX(-50%); background:rgba(0,0,0,0.7); color:white; padding:12px 24px; border-radius:8px; display:none; font-weight:bold; z-index:999; }

#motivational { position:fixed; top:50%; left:-100%; font-size:48px; color: rgba(255,255,255,0.15); font-weight:900; white-space:nowrap; pointer-events:none; z-index:1; transform:translateY(-50%); animation: floatLeftRight 15s linear infinite; }
@keyframes floatLeftRight { 0% {left:-100%;} 100% {left:100%;} }

#emptyMessage { text-align:center; color:rgb(223,82,82); }
#taskCounter { margin-top:15px; font-weight:bold; color:rgb(128,128,128); }

/* MOBILE RESPONSIVE */
@media (max-width: 480px) {
    body { padding: 15px; max-width: 100%; }
    h2 { font-size: 22px; }
    #taskInput { width: 100%; margin-bottom: 10px; }
    #btnAdd { width: 100%; padding: 12px; margin-bottom: 10px; }
    li { flex-direction: column; align-items: flex-start; padding: 10px; }
    li .removeBtn { align-self: flex-end; margin-top: 5px; }
    .modalBtns button { flex: 1 1 45%; font-size: 14px; padding: 10px 0; }
    #motivational { font-size: 36px; }
}
/* Task buttons container */
.taskBtns {
  display: flex;
  gap: 6px;
}

/* Edit button */
button.editBtn {
  background: #4F46E5;
  color: white;
  border: none;
  padding: 6px 10px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 14px;
  transition: 0.25s ease;
}

button.editBtn:hover {
  background: #4338CA;
  transform: scale(1.05);
  box-shadow: 0 4px 10px rgba(79, 70, 229, 0.4);
}

/* Remove button */
button.removeBtn {
  background: #EF4444;
  color: white;
  border: none;
  padding: 6px 10px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 14px;
  transition: 0.25s ease;
}

button.removeBtn:hover {
  background: #DC2626;
  transform: scale(1.05);
  box-shadow: 0 4px 10px rgba(239, 68, 68, 0.4);
}

/* Mobile responsive adjustments */
@media (max-width: 480px) {
  #taskInput {
    width: 100%;
    margin-bottom: 10px;
  }
  #btnAdd {
    width: 100%;
    margin-bottom: 10px;
  }
  li {
    flex-direction: column;
    align-items: flex-start;
  }
  .taskBtns {
    margin-top: 6px;
  }
  button.editBtn, button.removeBtn {
    width: 48%;
    font-size: 13px;
    padding: 6px 8px;
  }
}


  </style>
</head>

<body>
<h2>TODO App</h2>
<input type="text" id="taskInput" placeholder="Enter your task...">
<button id="btnAdd">Add</button>

<ul id="taskList"></ul>
<p id="emptyMessage">Your list is empty</p>
<div id="taskCounter">Total: 0 | Completed: 0 | Not Completed: 0</div>
<h2 id="motivational" style="display:none;"></h2>
<button id="clearAll">Clear All</button>
<div id="editModal">
  <div class="modalBox">
    <h3>Edit Task</h3>
    <input type="text" id="editInput">
    <div class="modalBtns">
      <button id="saveEdit">Save</button>
      <button id="cancelEdit">Cancel</button>
    </div>
  </div>
</div>

<div id="toast"></div>

<script>
let selectedTask = null;

function showToast(msg){
  $("#toast").stop(true,true).text(msg).fadeIn(300).delay(2000).fadeOut(300);
}

function updateEmptyMessage(){
  if($("#taskList li").length === 0) $("#emptyMessage").show(); else $("#emptyMessage").hide();
}

function updateTaskCounter(){
  let total = $("#taskList li").length;
  let completed = $("#taskList li.done").length;
  let notCompleted = total-completed;
  $("#taskCounter").text(`Total: ${total} | Completed: ${completed} | Not Completed: ${notCompleted}`);
}

function checkEmptyMotivation(){
  if($("#taskList li").length===0){
    $("#motivational").show().text("");
    typeWriter("Stay motivated! Add a task to start your journey.");
  } else {
    $("#motivational").hide();
  }
}

function typeWriter(text,i=0){
  if(i<text.length){
    $("#motivational").append(text.charAt(i));
    setTimeout(()=>typeWriter(text,i+1),100);
  }
}

function saveTasks(){ localStorage.setItem("tasks", $("#taskList").html()); }

function sendEmail(task, type){
  $.ajax({
    url:"http://localhost:4000/send-email",
    type:"POST",
    contentType:"application/json",
    data: JSON.stringify({task: `${type}: ${task}` }),
    success:function(res){ if(res.success) showToast(`${type} email sent!`) },
    error:function(err){ showToast(`Email failed!`) }
  });
}

// Load tasks from localStorage
$(document).ready(function(){
  if(localStorage.getItem("tasks")){
    $("#taskList").html(localStorage.getItem("tasks"));
  }
  updateEmptyMessage();
  updateTaskCounter();
  checkEmptyMotivation();
});

// Add task
// Add task
$("#btnAdd").click(function(){
  let task = $("#taskInput").val().trim();
  if(task===""){ alert("Enter task!"); return; }
  let incomplete = $("#taskList li:not(.done)").length;
  if(incomplete>=5){ alert("Max 5 incomplete tasks!"); return; }

  // Add task with Edit button
  $("#taskList").append(`
    <li>
      <span class="taskText">${task}</span>
      <div class="taskBtns">
        <button class="editBtn">Edit</button>
        <button class="removeBtn">x</button>
      </div>
    </li>
  `);

  $("#taskInput").val("");
  saveTasks(); updateEmptyMessage(); updateTaskCounter(); checkEmptyMotivation();
  
  // Only Added tasks send email
  sendEmail(task,"Added");
});

$("#taskInput").keyup(function(e){ if(e.key==="Enter") $("#btnAdd").click(); });

// Complete task
$(document).on("click","li .taskText", function(){
  $(this).parent().toggleClass("done");
  saveTasks(); updateEmptyMessage(); updateTaskCounter(); checkEmptyMotivation();
  let status = $(this).parent().hasClass("done") ? "Completed" : "Marked Incomplete";
  showToast(`Task ${status}`);
});

// Remove task
$(document).on("click",".removeBtn", function(){
  let taskText = $(this).closest("li").find(".taskText").text();
  $(this).closest("li").remove();
  saveTasks(); updateEmptyMessage(); updateTaskCounter(); checkEmptyMotivation();
  
  // Only Removed tasks send email
  sendEmail(taskText,"Removed");
  showToast(`Task Removed`);
});

// Edit task using button
$(document).on("click",".editBtn", function(){
  selectedTask = $(this).closest("li").find(".taskText");
  $("#editInput").val(selectedTask.text());
  $("#editModal").css("display","flex");
});

$("#saveEdit").click(function(){
  let updated=$("#editInput").val().trim();
  if(updated===""){ alert("Task cannot be empty!"); return; }
  selectedTask.text(updated);
  $("#editModal").hide();
  saveTasks(); updateEmptyMessage(); updateTaskCounter(); checkEmptyMotivation();
  showToast("Task Edited"); // Only toast, no email
});
$("#cancelEdit").click(()=>$("#editModal").hide());

// Clear all
$("#clearAll").click(function(){
  if($("#taskList li").length===0){ alert("List empty!"); return; }
  $("#taskList").empty();
  saveTasks(); updateEmptyMessage(); updateTaskCounter(); checkEmptyMotivation();
  showToast("All tasks cleared");
});

</script>
</body>
</html>
